%===============================================================================
%                        ┌─┐┬ ┬┌─┐┌─┐┬─┐┬  ┬┬┌─┐┌─┐┬─┐
%                        └─┐│ │├─┘├┤ ├┬┘└┐┌┘│└─┐│ │├┬┘
%                        └─┘└─┘┴  └─┘┴└─ └┘ ┴└─┘└─┘┴└─
%                                  TCP ECHO
%                               Callback module
%===============================================================================

-module(tcp_echo_sup).

-behaviour(supervisor).

%===============================================================================
%                                    MACROS
%===============================================================================

-define(SERVER, ?MODULE).

%===============================================================================
%                                  PUBLIC API 
%===============================================================================

-export([start_link/0]).

%===============================================================================
%                             SUPERVISOR CALLBACKS
%===============================================================================

-export([init/1]).

%===============================================================================
%                                  PUBLIC API 
%===============================================================================

%-------------------------------------------------------------------------------
% START_LINK/0
%
%-------------------------------------------------------------------------------
-spec start_link() -> {ok, Pid :: pid()} | 
                      ignore |
                      {error, {alread_started, Pid :: pid()}} |
                      {error, {shutdown, Reason :: term()}} |
                      {error, Reason :: term()}.
%-------------------------------------------------------------------------------
start_link() ->
    supervisor:start_link({local, ?SERVER}, ?MODULE, []).

%===============================================================================
%                             SUPERVISOR CALLBACKS
%===============================================================================

%-------------------------------------------------------------------------------
% INIT/1
%
%-------------------------------------------------------------------------------
-spec init(term()) -> {ok, {supervisor:sup_flags(), 
                            [supervisor:child_spec()]}} |
                      ignore.
%-------------------------------------------------------------------------------
init(_Args) ->
    SupFlags = #{strategy  => one_for_one, 
                 intensity => application:get_env(tcp_echo, supflag_intensity, 0), % DEV
                 period    => application:get_env(tcp_echo, supflag_period, 10)},
    Children = [#{id       => tcp_echo_server,
                  start    => {tcp_echo_server, start_link, []},
                  restart  => permanent,
                  shutdown => brutal_kill,
                  type     => worker,
                  modules  => [tcp_echo_server]}],
    {ok, {SupFlags, Children}}.

%===============================================================================
%                                   PRIVATE 
%===============================================================================
